・マジックナンバーからマクロ定義に変更

・処理が長かったので関数化